{"hash":"6a942ed5c048ddade2bf5e137405aa177d377427","data":{"post":{"id":"2cbca227a430b066098b313ef67db0b6","title":"Respecting Browser Navigation in Single Page Applications","content":"<p>Anchors (<code>&#x3C;a href=\"...\"></code>) offer a simple concept for navigating between web pages. Clicking on them opens the URL. When using the left mouse button, the HTML decides if the page is opened in the same tab (default) or in a new tab (<code>target=\"_blank\"</code>). Browsers provide the user with the possibility to override this behavior by middle clicking, <kbd>CTRL</kbd> clicking or using the context menu. </p>\n<p>The URL acts as a unique identifier for every document. You can save it and open it a later time to access the same document. This concept is known as <em>deep linking</em>.  </p>\n<p>Single Page Applications (short SPAs) often hook into the browser's navigation to prevent page reloads when navigating between pages. Implemented naively, this would prevent the current URL from changing. This would break deep linking as reloading the current URL would revert to the initial state of the SPA. For this reason, most SPA frameworks like Vue.js, React or Angular have a <em>router</em> API or library that implements navigation in a way that maps the browser URL to a component of your application.</p>\n<p>Let's look at how we can use <code>vue-router</code>, the standard router library for Vue.js, to implement navigation in a way that respects both deep linking and the user's choice <em>where</em> they want to open the clicked link. For an introduction to <code>vue-router</code>, refer to the <a href=\"https://router.vuejs.org/guide/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">official documentation</a>.</p>\n<h2 id=\"the-router-link-component\"><a href=\"#the-router-link-component\" aria-hidden=\"true\"><span class=\"hashtag\"></span></a>The &#x3C;router-link> Component</h2>\n<p>The easiest way to link between <em>routes</em> with <code>vue-router</code> is to use the <code>&#x3C;router-link></code> component. It accepts a prop named <code>to</code> that describes the target route.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>router-link</span> <span class=\"token attr-name\">:to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{ name: 'customer', props: { id: 1 } }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Open Customer 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>router-link</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Let's look at the rendered HTML:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>a</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>/customers/1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Open Customer 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>a</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The router has resolved the URL of the target route to a deep link (✅). Left clicks will be intercepted by an event handler to render the page without a reload but middle clicking will open the URL in a new tab, just like the user expects (✅).</p>\n<h2 id=\"the-router-plugin\"><a href=\"#the-router-plugin\" aria-hidden=\"true\"><span class=\"hashtag\"></span></a>The $router plugin</h2>\n<p>In addition to the <code>&#x3C;router-link></code> component, <code>vue-router</code> offers the <code>$router</code> plugin to trigger navigation programmatically. Here's how that could look.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">@click</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>openCustomer(1)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Open Customer 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">openCustomer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">$router</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'customer'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>           \n    <span class=\"token punctuation\">}</span>   \n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>Again, let's look at the rendered HTML:</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span><span class=\"token punctuation\">></span></span>Open Customer 1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>This is what I would call an anti-pattern. Left clicking the button will resolve the correct URL and open it in the current tab but now there's no way to open the link in a new tab or even to copy it to the clipboard (❌). This is very user-hostile. It's also bad for SEO, as crawlers won't be able to follow the link. </p>\n<p><strong>Don't do that!</strong> </p>\n<p>Now, that doesn't mean there's no legitimate use case for programmatic navigation. Sometimes a navigation happens as an indirect result of a different action. One example is when a new customer is created and the API asynchronously returns its ID. Programmatic navigation can be used to then open the customer details.</p>\n<h2 id=\"hybrid-approach\"><a href=\"#hybrid-approach\" aria-hidden=\"true\"><span class=\"hashtag\"></span></a>Hybrid approach</h2>\n<p>Finally, let's consider a use case where we want to allow the user to search for customers by name. We'll combine the two discussed approaches for the best user experience. For the implementation we'll use the <a href=\"https://buefy.org/documentation/autocomplete/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Autocomplete</a> component from the <a href=\"https://buefy.org\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Buefy</a> component library.</p>\n<pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>BAutocomplete</span> <span class=\"token attr-name\">:data</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>suggestions<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@typing</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>typed = $event<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">@select</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>navigateTo($event)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>template</span> <span class=\"token attr-name\">slot-scope</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>{ option: customer }<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>router-link</span> <span class=\"token attr-name\">:to</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>resolveCustomer(customer)<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n            {{ customer.name }}\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>router-link</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>BAutocomplete</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>template</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span><span class=\"token punctuation\">></span></span><span class=\"token script\"><span class=\"token language-javascript\">\n<span class=\"token keyword module\">export</span> <span class=\"token keyword module\">default</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">data</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token literal-property property\">customers</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token literal-property property\">typed</span><span class=\"token operator\">:</span> <span class=\"token string\">''</span>        \n        <span class=\"token punctuation\">}</span>     \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">computed</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">suggestions</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">customers</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">filter</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">c</span> <span class=\"token arrow operator\">=></span> c<span class=\"token punctuation\">.</span><span class=\"token property-access\">name</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">includes</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">typed</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>       \n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">methods</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">resolveCustomer</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword control-flow\">return</span> <span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">name</span><span class=\"token operator\">:</span> <span class=\"token string\">'customer'</span><span class=\"token punctuation\">,</span> <span class=\"token literal-property property\">props</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span> id <span class=\"token punctuation\">}</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token function\">navigateTo</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">id</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token property-access\">$router</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">push</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span><span class=\"token method function property-access\">resolveCustomer</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>        \n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>   \n<span class=\"token punctuation\">}</span>\n</span></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></code></pre>\n<p>The autocomplete is populated with the list of customers filtered by the user's typed query. We utilize a <a href=\"https://vuejs.org/v2/guide/components-slots.html#Scoped-Slots-with-the-slot-scope-Attribute\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">scoped slot</a> to render the list items in the dropdown as <code>&#x3C;router-link></code>s. This way, the user can middle click the items or use the context menu to copy the URL (✅). However, we also handle the <code>@select</code> event of the autocomplete. It is triggered when the user selects a suggestion from the dropdown using the <kbd>Enter</kbd> key. In this case, we use programmatic navigation (<code>$router.push</code>) to navigate to the chosen route. </p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-hidden=\"true\"><span class=\"hashtag\"></span></a>Conclusion</h2>\n<p>We have seen that using programmatic navigation can lead to worse user experience as users won't be able to use standard browser mechanisms like opening links a new tab or copying the URL to clipboard. The developers of <code>vue-router</code> have obviously considered this when designing the library and made it easy to <em>do the right thing</em>. Other frameworks offer similar features.</p>\n<p>Next time when you resort to programmatic navigation, consider that users want to do more with links than opening them in place. When possible rely on standard browser mechanisms for the best user experience.  </p>\n","date":"1 July 2020","twitter":"https://twitter.com/Cypressious/status/1278338377444622337","bluesky":"","description":"How to provide navigation in Single Page Applications that respects the browser"}},"context":{}}